<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f3f4f6; color: #1f2937; }
        
        /* Layout */
        .admin-container { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: #065f46; color: white; padding: 1.5rem; }
        .sidebar h2 { margin-bottom: 2rem; display: flex; align-items: center; gap: 0.5rem; }
        .menu-item { display: block; padding: 1rem; color: #d1fae5; text-decoration: none; border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.1); color: white; }
        .main-content { flex: 1; padding: 2rem; overflow-y: auto; }

        /* Cards */
        .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        .card h3 { color: #065f46; margin-bottom: 1rem; border-bottom: 2px solid #ecfdf5; padding-bottom: 0.5rem; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; }
        .stat-num { font-size: 2.5rem; font-weight: bold; color: #10b981; }
        .stat-label { color: #6b7280; font-size: 0.9rem; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { text-align: left; padding: 1rem; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; color: #374151; }
        
        /* Form Elements */
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-control { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; }
        .btn { padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer; color: white; font-weight: 500; }
        .btn-green { background: #10b981; }
        .btn-red { background: #ef4444; }
        
        /* Tabs Logic (Simple JS) */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="sidebar">
            <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
            <div class="menu-item active" onclick="switchTab('dashboard')"><i class="fas fa-chart-line"></i> ภาพรวมสถิติ</div>
            <div class="menu-item" onclick="switchTab('users')"><i class="fas fa-users"></i> จัดการผู้ใช้</div>
            <div class="menu-item" onclick="switchTab('settings')"><i class="fas fa-cog"></i> ตั้งค่าระบบ</div>
            <div class="menu-item" onclick="switchTab('content')"><i class="fas fa-file-alt"></i> จัดการเนื้อหา</div>
            <a href="/logout" class="menu-item" style="margin-top: 2rem; color: #fca5a5;"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</a>
        </div>

        <div class="main-content">
            
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 1.5rem;">ภาพรวมระบบ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-num">{{ stats.today }}</div>
                        <div class="stat-label">แปลงที่อัปโหลดวันนี้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-num">{{ stats.month }}</div>
                        <div class="stat-label">แปลงเดือนนี้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-num">{{ stats.year }}</div>
                        <div class="stat-label">แปลงปีนี้</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-num">{{ stats.avg_weeks }}</div>
                        <div class="stat-label">อายุเฉลี่ย (สัปดาห์)</div>
                    </div>
                </div>
                <div class="card">
                    <h3>รายงานสรุป</h3>
                    <p>คุณสามารถพิมพ์หน้านี้เพื่อใช้เป็นรายงานได้</p>
                    <button class="btn btn-green" onclick="window.print()"><i class="fas fa-print"></i> พิมพ์รายงาน</button>
                </div>
            </div>

            <div id="users" class="tab-content">
                <h2 style="margin-bottom: 1.5rem;">จัดการผู้ใช้</h2>
                
                <div class="card">
                    <h3>เพิ่มผู้ดูแลระบบ/ผู้ใช้ใหม่</h3>
                    <form action="/admin/user/add" method="POST" style="display: flex; gap: 1rem; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label>อีเมล</label>
                            <input type="email" name="email" class="form-control" required>
                        </div>
                        <div style="flex: 1;">
                            <label>รหัสผ่าน</label>
                            <input type="text" name="password" class="form-control" required>
                        </div>
                        <div style="width: 150px;">
                            <label>สิทธิ์</label>
                            <select name="role" class="form-control">
                                <option value="admin">Admin</option>
                                <option value="user">User</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-green">เพิ่ม</button>
                    </form>
                </div>

                <div class="card">
                    <h3>รายชื่อผู้ใช้ทั้งหมด</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>อีเมล</th>
                                <th>สิทธิ์</th>
                                <th>จัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.email }}</td>
                                <td>
                                    <span style="background: #d1fae5; color: #065f46; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">
                                        {{ user.role }}
                                    </span>
                                </td>
                                <td>
                                    {% if user.email != 'admin01@gmail.com' %}
                                    <form action="/admin/user/delete" method="POST" onsubmit="return confirm('ยืนยันการลบ?');">
                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                        <button type="submit" class="btn btn-red" style="font-size: 0.8rem;">ลบ</button>
                                    </form>
                                    {% else %}
                                    <span style="color: #9ca3af; font-size: 0.8rem;">(ห้ามลบ)</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <h2 style="margin-bottom: 1.5rem;">ตั้งค่าคุณภาพและไฟล์</h2>
                <form action="/admin/save_settings" method="POST">
                    <div class="card">
                        <h3>การอัปโหลด</h3>
                        <div class="form-group">
                            <label>ขนาดไฟล์สูงสุด (MB)</label>
                            <input type="number" name="max_file_size" class="form-control" value="{{ settings.max_file_size or '10' }}">
                        </div>
                        <div class="form-group">
                            <label>ประเภทไฟล์ที่รองรับ (คั่นด้วยคอมมา)</label>
                            <input type="text" name="allowed_file_types" class="form-control" value="{{ settings.allowed_file_types or 'jpg, png, jpeg' }}">
                        </div>
                    </div>
            </div>

            <div id="content" class="tab-content">
                <h2 style="margin-bottom: 1.5rem;">จัดการเนื้อหาประกาศ/คู่มือ</h2>
                    <div class="card">
                        <h3>ประกาศหน้าเว็บ</h3>
                        <div class="form-group">
                            <textarea name="announcement_text" class="form-control" rows="4">{{ content.announcement }}</textarea>
                        </div>
                    </div>
                    <div class="card">
                        <h3>คู่มือการใช้งาน / เงื่อนไข</h3>
                        <div class="form-group">
                            <textarea name="manual_text" class="form-control" rows="6">{{ content.manual }}</textarea>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-green" style="font-size: 1.1rem; padding: 1rem 2rem;">บันทึกการตั้งค่าทั้งหมด</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Highlight menu
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>